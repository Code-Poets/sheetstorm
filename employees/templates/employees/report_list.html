{% extends 'base.html' %}

{% load i18n %}
{% load static %}

{% load data_display_filters %}
{% load data_structure_element_selectors %}

{% block extra_head %}
    <link
        rel="stylesheet"
        href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css"
        integrity="sha384-Nlo8b0yiGl7Dn+BgLn4mxhIIBU6We7aeeiulNCjHdUv/eKHx59s3anfSUjExbDxn"
        crossorigin="anonymous"
    />
    <link
        rel="stylesheet"
        type="text/css"
        href="{% static 'employees/style.css' %}"
        integrity="{% staticinline "employees/style.css" encode="sri" %}"
        crossorigin="anonymous"
    />
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
        crossorigin="anonymous"
    />
    <link
        rel="stylesheet"
        type="text/css"
        href="{% static 'employees/popup_style.css' %}"
        integrity="{% staticinline 'employees/popup_style.css' encode="sri" %}"
        crossorigin="anonymous"
    />
{% endblock %}

{% block content %}
  <div class="container main-white-container margin-top-space">
    {% include "employees/partial/report_list_navigation_bar.html" %}
    <div class="container narrower-container">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <td class="td-text-align-left" colspan="3">
                <b><h4>{{user.get_full_name}}</b></h4>
              </td>
              <td class="hidden-print" colspan="3">
                <hr class="hr-blue-line">
              </td>
            </tr>
            <tr>
              <th class="date-header th-blue-border-first-cell">{{ UI_text.DATE_COLUMN_HEADER.value }}</th>
              <th class="project-header th-blue-border">{{ UI_text.PROJECT_COLUMN_HEADER.value }}</th>
              <th class="task-activities-header th-blue-border">{{ UI_text.TASK_ACTIVITIES_COLUMN_HEADER.value }}</th>
              <th class="th-blue-border">{{ UI_text.DESCRIPTION_COLUMN_HEADER.value }}</th>
              <td class="edit-button-header Invisible hidden-print"></td>
              <th class="work-hours-header th-blue-border">{{ UI_text.WORK_HOURS_COLUMN_HEADER.value }}</th>
            </tr>
          </thead>
          <tbody>
            {% regroup object_list by date as date %}
              {% for reports in date %}
                {% for report in reports.list %}
                  {% if forloop.first %}
                    <tr class="tr-next-day-separator">
                      <td class="date-column" rowspan={{ reports.list|length }}><strong>{{ reports.grouper| date:"l, d F Y" }}</strong></td>
                  {% else %}
                    <tr>
                  {% endif %}
                    <td class="project-column">{{ report.project }}</td>
    ï»¿                <td class="task-activities-column">{{ report.task_activities }}</td>
                    <td class="description-column">{{ report.description|safe|urlize|annotate_no_follow_link_with_css_class:"pagelink" }}</td>
                    <td class="edit-button-column Invisible hidden-print">
                    {% if report.editable %}
                      <a href="{% url 'custom-report-detail' pk=report.id %}" class="btn btn-light hidden-print">
                        <span class="glyphicon glyphicon-edit span-edit-report hidden-print"></span>
                      </a>
                    {% endif %}
                    </td>
                    <td class="work-hours-column">{{ report.work_hours_str }}</td>
                  </tr>
                {% endfor %}
                <tr class="tr-next-day-separator">
                  <td></td>
                  <td><strong>{{ UI_text.HOURS_PER_DAY_LABEL.value }}</strong></td>
                  <td colspan="2"></td>
                  <td class="edit-button-column Invisible hidden-print"></td>
                  <td class="work-hours-column"><strong>{{ daily_hours_sum|get_key_value:reports.grouper|duration_field_to_string }}</strong></td>
                </tr>
              {% endfor %}
              <tr class="tr-next-day-separator">
                {% if not date|length == 0 %}
                  <td class="td-text-align-left"><strong>{{ UI_text.HOURS_PER_MONTH_LABEL.value }}</strong></td>
                  <td colspan="3"></td>
                  <td class="hidden-print"></td>
                  <td class="work-hours-column"><strong>{{ monthly_hours_sum|get_key_value:user.pk|duration_field_to_string }}</strong></td>
                {% endif %}
              </tr>
          </tbody>
        </table>
        {% include "employees/partial/projects_work_percentage.html" %}
      </div>
    </div>

    {% if object_list %}
      <div class="double-space-margin-bottom">
        <a href="{% url 'export-data' pk=user.pk year=year month=month %}" class="btn btn-success">
          Export {{ month | convert_to_month_name }} {{ year }} Reports to XLSX
        </a>
        <a href="{% url 'export-data' pk=user.pk year=year month=month %}?format=csv" class="btn btn-success">
          Export {{ month| convert_to_month_name }} {{ year }} Reports to CSV
        </a>
      </div>
    {% endif %}
  </div>
{% endblock %}

{% block extra_script %}
  {{ form.media }}
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.10/jquery.mask.js"></script>
  {{ month_form.media }}
  <script src="//code.jquery.com/jquery-3.3.1.js"></script>
  <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="{% static 'employees/scripts/create_and_join_popup_window.js' %}"></script>
  {% if hide_join %}
    <script type="text/javascript">
      document.getElementById("join_form").hidden = true;
    </script>
  {% endif %}
  <script src="{% static 'employees/scripts/load_activities_for_project.js' %}"></script>
  {% if form.errors or form.non_field_errors%}
    <script type="text/javascript">
      var form_errors = true;
    </script>
  {% else %}
    <script type="text/javascript">
      var form_errors = false;
    </script>
  {% endif %}
{% endblock %}
