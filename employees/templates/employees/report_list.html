{% extends 'base.html' %}

{% load i18n %}
{% load rest_framework %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" type="text/css" href="{% static 'employees/style.css' %}">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
{% endblock %}

{% block content %}
<h1>{{ UI_text.PAGE_TITLE.value }}</h1>

<input type="button" id="opener" value="{{ UI_text.JOIN_PROJECT_BUTTON.value }}"/>

<div class="modal-dialog">
    <form action="{% url 'custom-report-list' %}" method="POST">
        {% csrf_token %}
        {% render_form serializer template_pack='rest_framework/vertical' %}
        <a href="https://guides.github.com/features/mastering-markdown/" target="_blank">Markdown is supported</a><br/>
       <input type="submit" value="{{ UI_text.CREATE_REPORT_BUTTON.value }}">
    </form>
</div>

<div id="dialog" style="display: none" title="{{ UI_text.JOIN_POPUP_HEADER.value }}" align="center">
    <form action="{% url 'custom-report-list' %}" id="join_form" method="POST">
        {% csrf_token %}
        {{ project_form }}
        <input type="submit" name="join" value="{{ UI_text.JOIN_POPUP_YES.value }}">
    </form>
    {% if hide_join %}
        {{ UI_text.NO_PROJECTS_TO_JOIN.value }}
    {% endif %}
</div>

</br>
<div class="container">
    <div class="table-responsive">
        <table class="table">
            <tr>
                <th class="date-header">{{ UI_text.DATE_COLUMN_HEADER.value }}</th>
                <th class="project-header">{{ UI_text.PROJECT_COLUMN_HEADER.value }}</th>
                <th class="task-activities-header">{{ UI_text.TASK_ACTIVITIES_COLUMN_HEADER.value }}</th>
                <th class="work-hours-header">{{ UI_text.WORK_HOURS_COLUMN_HEADER.value }}</th>
                <th>{{ UI_text.DESCRIPTION_COLUMN_HEADER.value }}</th>
                <td class="edit-button-header Invisible"></td>
            </tr>
            {% for date, reports in reports_dict.items %}
            <tr>
                <td class="date-column" rowspan={{ reports|length }}>
                    {{ date }}
                </td>
                {% for report in reports %}
                    {% if forloop.counter > 1 %}
                    <tr>
                    {% endif %}
                <td class="project-column">
                    {{ report.project }}
                </td>
                <td class="task-activities-column">
                    {{ report.task_activities }}
                </td>
                <td class="work-hours-column">
                    {{ report.work_hours_str }}
                </td>
                <td class="description-column">
                {{ report.markdown_description|safe }}
                <td>
                <td class="edit-button-column Invisible">
                    {% if report.editable %}
                    <a href="{% url 'custom-report-detail' pk=report.id %}" class="btn btn-info">
                        <span class="glyphicon glyphicon-pencil"></span>
                    </a>
                    {% endif %}
                </td>
            </tr>
                {% endfor %}
            {% endfor %}
        </table>
    </div>
</div>
{% endblock %}

{% block extra_script %}
    <script src="//code.jquery.com/jquery-1.12.4.js"></script>
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript">
        var join_discard_text = "{{ UI_text.JOIN_POPUP_NO.value }}";
    </script>
    <script src="{% static 'employees/scripts/join_popup_window.js' %}"></script>
    {% if hide_join %}
        <script type="text/javascript">
            document.getElementById("join_form").hidden = true;
        </script>
    {% endif %}
{% endblock %}
