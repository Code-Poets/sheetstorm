{% load static %}
{% load data_display_filters %}
{% load data_structure_element_selectors %}
{% url 'custom-report-list' year month as custom_report_list_url %}

{% for reports in date %}
    {% for report in reports.list %}
        {% if forloop.first %}
            <tr class="tr-next-day-separator">
                <td class="date-column" rowspan={{ reports.list|length|add:1 }}>
                    <strong>{{ reports.grouper| date:"l, d F Y" }}</strong>
                </td>
                <td class="expand-report-list-column" rowspan={{ reports.list|length|add:1 }}>
                    {% if not forloop.last %}
                        <div class="expand-reports-icon" onclick="expandReportList(this, {{ reports.list|length }})" title="Expand report list">
                            <div class="blue-dot-expand-icon">
                                <div class="blue-dot"></div>
                                <div class="report-list-vl"></div>
                            </div>
                            <div class="rotated-tip">
                                <div class="custom-tip"></div>
                            </div>
                        </div>
                    {%  endif %}
                </td>
        {% else %}
            <tr class="hidden-report-row">
        {% endif %}
    <td class="project-column">{{ report.project }}</td>
    <td class="task-activities-column" >{{ report.task_activities }}</td>
    <td class="work-hours-column">{{ report.work_hours_str }}</td>
    <td class="description-column">
        {{ report.description|linebreaks|safe|urlize|annotate_no_follow_link_with_css_class:"pagelink" }}
    </td>
    <td class="edit-button-column Invisible hidden-print">
        {% if report.editable %}
            {% if request.user == report.author %}
                <button data-form-url="{% url 'custom-report-detail' report.id %}" class="bs-modal  hidden-print no-background">
            {% else %}
                <button data-form-url="{% url 'admin-report-detail' pk=report.id %}" class="bs-modal hidden-print no-background">
            {% endif %}
                <span class="glyphicon glyphicon-edit span-edit-report hidden-print"></span>
            </button>
        {% endif %}
    </td>
    </tr>
        {% if forloop.last %}
            <tr class="day-summary-row">
                <td class="hours-summary"><strong>{{ UI_text.HOURS_PER_DAY_LABEL.value }}</strong></td>
                <td colspan="1"></td>
                <td class="work-hours-column">
                    <strong>{{ daily_hours_sum|get_key_value:reports.grouper|duration_field_to_string }}</strong>
                </td>
                <td colspan="2"></td>
            </tr>
        {% endif %}
    {% endfor %}
{% endfor %}

<script type="text/javascript">
    $(function () {
        $(".bs-modal").each(function () {
            $(this).modalForm({
                formURL: $(this).data('form-url')
            });
        });
    });
</script>

